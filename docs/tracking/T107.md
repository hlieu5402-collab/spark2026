# T-107 教案级跟踪任务清单

> 目的：将零散的代办/修复/临时标记转化为可执行的任务条目，方便在 Sprint 中排期与跟进。

## 元信息

- **生成日期**：2025-01-15
- **维护人**：@spark-pm
- **关联需求**：T-107 代办标记处置闭环

## 任务总览

| 任务编号 | 描述 | 所属组件 | 负责人 | 截止日期 | 当前状态 |
| --- | --- | --- | --- | --- | --- |
| compat-v0-cleanup | 清理 `compat_v0` 兼容模块，让所有调用方直接返回 `ReadyState`。 | spark-core/compat | @spark-core-maintainers | 2025-03-31 | 未开始 |
| readystate-model-telemetry | 扩展 ReadyState 模型记录，以覆盖错误码等新增上下文。 | spark-core/tests | @spark-core-qe | 2025-04-15 | 未开始 |
| chaos-runner-batch-support | 让混沌 Runner 支持在一次命令中批量执行多个场景。 | tools/chaos | @spark-sre | 2025-05-01 | 调研中 |
| msrv-doc-sync | 为文档与 README 增加 Rust 版本号巡检，确保与 MSRV 一致。 | tools/ci | @spark-infra | 2025-03-01 | 未开始 |

## 任务细节

### compat-v0-cleanup

- **来源**：`crates/spark-core/src/compat/flow_ready.rs`
- **目标**：完成调用方迁移后删除 `compat_v0` 模块，并确保公共 API 直接输出 [`ReadyState`]。
- **关键步骤**：
  1. 统计仍依赖 `compat_v0` 的调用方列表，协调各域升级计划。
  2. 在迁移完成后删除兼容模块及关联测试，更新《docs/state_machines.md》。
  3. 运行 `cargo test --workspace` 确认行为一致，并在发布说明中声明破坏性变更。
- **验收标准**：CI 无残留依赖 `compat_v0` 的编译单元；文档与示例均展示最新使用方式。

### readystate-model-telemetry

- **来源**：`crates/spark-core/tests/state_machine_properties.rs`
- **目标**：当 ReadyState 引入错误码等上下文时，更新影子模型以覆盖新增字段，并保持性质验证完整。
- **关键步骤**：
  1. 扩展 `ReadyLeafState` 与事件生成器，记录错误码或附加上下文。
  2. 调整性质断言，验证上下文在 Pending → 唤醒 → Ready 流程中保持一致。
  3. 更新测试文档，说明新字段的生成策略与断言含义。
- **验收标准**：Proptest/Loom 测试覆盖新的上下文分支；CI 中模型测试通过。

### chaos-runner-batch-support

- **来源**：`tools/chaos/run.sh`
- **目标**：提供批量执行多个场景文件的能力，减少 SRE 多次手动调用的负担。
- **关键步骤**：
  1. 设计批量模式的参数格式与输出约定，避免破坏现有单场景行为。
  2. 引入并发或串行调度策略，确保日志隔离与错误聚合清晰。
  3. 在 Runbook 中记录新能力，并为批量模式添加端到端测试用例。
- **验收标准**：脚本支持 N 个场景的执行，并能在任意场景失败时返回非零退出码同时保留所有日志路径。

### msrv-doc-sync

- **来源**：`tools/ci/check_msrv_guard.sh`
- **目标**：巡检 README、指南等文档中的 Rust 版本号，防止与 MSRV 脱节。
- **关键步骤**：
  1. 选取合适的工具（如 `rg` 或自研 Rust 脚本）扫描固定格式的版本号。
  2. 建立白名单机制，避免误报历史文档或示例中的旧版本号。
  3. 将新检查纳入 CI，并撰写维护指南说明如何更新白名单。
- **验收标准**：CI 可在文档版本号与 MSRV 不一致时失败，并给出清晰的修复指引。

[ReadyState]: ../../crates/spark-core/src/status/mod.rs
