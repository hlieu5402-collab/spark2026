# Spark Scorecard 9.8+/10 量化门禁

本评分卡用于在持续集成阶段评估 Spark 2026 在「体验 (DX)」「鲁棒性 (Robustness)」「可运维性 (Operability)」「性能 (Performance)」四个维度上的综合表现。每个维度都提供可机检的量化指标、权重与达标阈值，从而确保客观门控。

## 总览

- **目标门槛**：综合得分 ≥ 9.8 / 10。
- **评分模型**：采用加权平均，各维度得分 ∈ [0, 10]，最终分值 = Σ(维度得分 × 权重)。
- **必备条件**：任意维度若未满足硬性指标（标记为 `TCK=必过` 或显式硬门），即判定整体验收失败。

| 维度 | 权重 | 评分逻辑概述 | 硬性门槛 |
| ---- | ---- | ------------ | -------- |
| DX 体验 | 0.25 | 按 TCK 自动化结果和 BoxService 延迟映射得分 | TCK=必过 |
| Robustness | 0.30 | 按 Cancel 传播延迟、宏级分配策略和重试契约判定 | Cancel 传播 < 5 ms |
| Operability | 0.20 | 按 RetryAfter 合约与运行期指标覆盖率计分 | RetryAfter 合约全绿 |
| Performance | 0.25 | 按 BoxService P99、epoch/config_epoch 在线比例评估 | BoxService P99 < 3% |

## DX 体验 (权重 0.25)

- **量化指标**：
  - 自动化测试套件 (TCK) 全量通过率必须 100%。任何失败项即使单项得分高，也直接判定本维度失效。
  - BoxService 请求端到端 P99 延迟需 < 3% 的请求超过 3 ms，得分按线性映射：
    - 0%~1% 超标：10 分；
    - 1%~3%：线性插值至 8 分；
    - ≥3%：本指标记 0 分并触发硬门。
- **备注**：TCK 用作 DX 的必过检查，强调开发者体验基线。

## Robustness (权重 0.30)

- **量化指标**：
  - Cancel 信号端到端传播延迟 < 5 ms。超出阈值即判定硬门失败。
  - 宏分配 (macro scheduling) 违规次数必须为 0，一旦出现说明隔离策略失效，该维度记 0 分。
  - RetryAfter 协议状态：
    - 所有契约项均处于绿色 (全绿) 时得 10 分；
    - 若存在黄色项，降至 7 分；
    - 出现红色项则本维度记 0 分。

## Operability (权重 0.20)

- **量化指标**：
  - 运行时可观测性：`epoch` 与 `config_epoch` 监控指标需保持 99.5% 以上时间在线（数据上报无缺口）。
    - 在线率 ≥ 99.5%：10 分；
    - 98%~99.5%：线性插值至 7 分；
    - < 98%：本指标记 0 分。
  - 运维手册契约：RetryAfter 合约必须全绿，若有降级标记，则本维度最高 5 分并记录缺陷待修。
- **备注**：强调持续运维可见性与契约治理的闭环。

## Performance (权重 0.25)

- **量化指标**：
  - BoxService 服务端 P99 延迟需 < 3 ms，且 3% 阈值与 DX 一致，便于共用监控通道。
  - 关键数据面指标（如 epoch/config_epoch）在高负载下保持在线率 ≥ 99.5%，与 Operability 指标互证；低于阈值时性能得分上限 6 分。
  - 历史回放或压测场景中，RetryAfter 返回率需维持 < 0.1%，否则说明存在系统性退避，性能得分上限 4 分。

## 评分计算与验收

1. 收集各指标的监控数据、合约检查报告与测试产物，写入 CI 阶段制品。
2. 使用自动化脚本聚合分数并与本评分卡对照。
3. 综合得分 ≥ 9.8 且所有硬门通过方可合入主干。

## 附录：产物要求

- **测试产物**：TCK 测试报告（JUnit/XML 或等效格式）。
- **监控快照**：BoxService P99 延迟报表、Cancel 延迟探针数据、RetryAfter 合约仪表板导出。
- **运维指标**：epoch/config_epoch 在线率报表，需包含数据来源与时间范围。
- **验证记录**：自动化脚本运行日志，记录评分计算结果与阈值校验过程。
