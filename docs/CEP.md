# 变更提案（CEP）流程

本文档定义 Spark 项目变更提案（Change Enhancement Proposal, CEP）的提交、评审与归档流程，用于管控公共 API 及其他重大变更，确保方案可追踪、风险可控。

## 适用范围

- **公共 API 变更**：包含新增、修改、废弃任何稳定或计划稳定的 API。
- **跨团队重大架构调整**：对核心模块、性能模型、兼容性策略产生广泛影响的改动。
- **外部依赖策略调整**：引入 / 升级 / 替换关键第三方依赖。
- **治理规则要求的其他场景**：CODEOWNERS 或技术委员会指定的需立项事项。

未提交 CEP 的公共 API 变更将被拒绝合并。

## 流程概览

1. **提出草案**：
   - 在 `docs/governance/` 目录下新建 `CEP-<序号>-<简短主题>.md` 文档；
   - 参照本文档提供的模板撰写背景、动机、方案与兼容性策略；
   - 在 PR 模板的 CEP 区域填写对应信息。
2. **征求反馈**：
   - 将草案分享至指定的沟通渠道，邀请相关 CODEOWNER 与领域专家评审；
   - 在文档中记录讨论要点、替代方案与待决议事项。
3. **达成共识**：
   - 收集必要审批：至少包含目标目录的 CODEOWNER 和一名架构委员会成员；
   - 将状态从“讨论中”更新为“已定稿”，并记录最终决定。
4. **执行与回溯**：
   - 在实现 PR 中引用 CEP 编号；
   - 变更合并后更新实施记录与后续工作项；
   - 若方案废弃，需新增补丁将状态标记为“废弃”，并给出原因。

## 编号规则

- 序号采用四位数字递增（例如：CEP-0001、CEP-0002）；
- 同一主题存在多个修订时，沿用原编号并追加修订号，如 `CEP-0001-R1`；
- 文档文件名必须与标题编号保持一致，便于检索与引用。

## 文档模板

```markdown
# CEP-xxxx: <标题>

- 作者：<GitHub ID / 团队>
- 审批人：<列出全部必需 CODEOWNER 及委员会成员>
- 创建日期：YYYY-MM-DD
- 状态：草案 / 讨论中 / 已定稿 / 废弃
- 版本：v1.0

## 摘要
- 用 2-3 句话说明目标、背景与收益。

## 背景与动机
- 描述当前痛点、约束与问题；
- 指出为何现有方案不足。

## 目标与非目标
- 列出本次期望达成的结果；
- 明确不在本次处理范围内的事项。

## 方案概述
- 提供核心设计、关键数据结构、算法或协议的描述；
- 对于复杂逻辑，可使用步骤列表、序列图或伪代码说明流程。

## 兼容性与迁移
- 说明对现有 API、用户或运维流程的影响；
- 给出迁移路径、降级与回滚策略。

## 影响分析
- 性能、稳定性、安全性等方面的收益与风险；
- 边界情况、失败模式与缓解手段。

## 替代方案
- 列举考虑过的替代设计及放弃原因。

## 开放问题
- 尚待验证或需要后续跟进的事项。

## 实施计划
- 里程碑、阶段性交付与验收标准；
- 对应 PR / Issue / 任务追踪链接。

## 变更记录
- YYYY-MM-DD：描述修订内容与原因。
```

## 审批与合并要求

- PR 合并前，需在讨论记录中给出全部必需审批人的显式同意；
- 与 CEP 相关的实现 PR 必须在描述中引用 `CEP-xxxx` 编号；
- CODEOWNERS 列出的目录 Owner 拥有否决权，可要求补充数据或修订方案；
- CEP 实施完成后，应在“变更记录”章节登记上线结果与遗留问题。

## 附录

- [CEP-0001: 公共 API 稳定性等级示例](governance/CEP-0001-public-api-stability.md)

> 若需新增示例，请复制模板并在“附录”区域登记，确保编号不冲突。
